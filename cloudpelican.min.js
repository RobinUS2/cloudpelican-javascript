/**
 * CloudPelican javascript library
 * @version 0.3
 * @author Robin Verlangen
 */
cloudpelican={config:{token:"",write_interval_ms:200,listeners:{window_error:true,console_log:true,console_error:true,console_warn:true,console_debug:true,console_trace:true},endpoint:"https://api.cloudpelican.com/api/push/",init_passed:false},_oldListeners:{},_applyOldListener:function(e,t,n){var r=cloudpelican._oldListeners[e];if(typeof r==="function"){return r.apply(t,n)}return false},init:function(e){if(typeof e!=="undefined"&&e!==null&&e.length>0){cloudpelican.config.token=e}if(cloudpelican.config.token.length===0){console.error("CLOUDPELICAN: Please fill in your API token");return false}if(cloudpelican.config.listeners.window_error===true){cloudpelican._oldListeners["window_error"]=window.onerror;window.onerror=function(){try{var e=arguments[0];cloudpelican.log(e,true,{url:arguments[1],line:arguments[2]})}catch(t){}return cloudpelican._applyOldListener("window_error",window,arguments)}}if(cloudpelican.config.listeners.console_log===true){cloudpelican._oldListeners["console_log"]=console.log;console.log=function(){try{var e=arguments[0];cloudpelican.log(e,false)}catch(t){}return cloudpelican._applyOldListener("console_log",console,arguments)}}if(cloudpelican.config.listeners.console_error===true){cloudpelican._oldListeners["console_error"]=console.error;console.error=function(){try{var e=arguments[0];cloudpelican.log(e,true)}catch(t){}return cloudpelican._applyOldListener("console_error",console,arguments)}}if(cloudpelican.config.listeners.console_warn===true){cloudpelican._oldListeners["console_warn"]=console.warn;console.warn=function(){try{var e=arguments[0];cloudpelican.log(e,true)}catch(t){}return cloudpelican._applyOldListener("console_warn",console,arguments)}}if(cloudpelican.config.listeners.console_debug===true){cloudpelican._oldListeners["console_debug"]=console.debug;console.debug=function(){try{var e=arguments[0];cloudpelican.log(e,false)}catch(t){}return cloudpelican._applyOldListener("console_debug",console,arguments)}}if(cloudpelican.config.listeners.console_trace===true){cloudpelican._oldListeners["console_trace"]=console.trace;console.trace=function(){try{var e=arguments[0];cloudpelican.log(e,false)}catch(t){}return cloudpelican._applyOldListener("console_trace",console,arguments)}}cloudpelican.config.init_passed=true;return cloudpelican.config.init_passed},log:function(e,t,n){if(typeof e==="undefined"||e===null||e.length===0){return false}if(e.indexOf("CLOUDPELICAN:")===0){return false}var r={};r["msg"]=e;r["host"]=this._getHost();r["dt"]=this._getTime();if(typeof t!=="undefined"&&t===true){r["error"]="1"}if(typeof n!=="undefined"&&n!==null){for(var i in n){r[i]=n[i]}}var s={fields:r};this._write(s);return true},_getTime:function(){return Math.round(new Date)},_host:null,_getHost:function(){if(this._host===null){this._host=document.location.host.toString()}return this._host},_writeStack:[],_writeTimeout:null,_writeSequence:0,_domReady:false,_write:function(e){this._writeStack.push(e);if(this._writeTimeout===null){var t=function(){var t=cloudpelican._writeStack;cloudpelican._writeStack=[];cloudpelican._writeTimeout=null;cloudpelican._writeSequence++;var n=t.length===1?"single":"bulk";var r=cloudpelican.config.endpoint+n+"?js=1&t="+encodeURIComponent(cloudpelican.config.token);for(i in t){e=t[i];for(k in e.fields){val=e.fields[k];r+="&f";if(n==="bulk"){r+="["+i+"]"}r+="["+encodeURIComponent(k)+"]="+encodeURIComponent(val)}}var s=document.createElement("script");s.async=true;s.defer=true;s.id="cloudpelican_"+cloudpelican._writeSequence;s.src=r;s.onload=function(e){document.body.removeChild(this)};document.body.appendChild(s)};this._writeTimeout=setTimeout(t,this.config.write_interval_ms)}return true}}
